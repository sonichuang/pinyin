<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åœ°å€è½¬æ¢å™¨ V5 (ç²¾å‡†åˆ‡å‰²ç‰ˆ)</title>
    <script src="https://unpkg.com/pinyin-pro"></script>
    <style>
        :root { --primary: #2563eb; --bg: #f8fafc; --border: #cbd5e1; --text: #334155; }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; background: var(--bg); padding: 20px; color: var(--text); }
        .container { max-width: 900px; margin: 0 auto; background: #fff; padding: 30px; border-radius: 12px; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1); }
        h1 { text-align: center; color: #0f172a; margin-bottom: 20px; font-size: 20px; font-weight: 700; }
        
        /* è¾“å…¥åŒº */
        label { display: block; font-weight: 700; margin-bottom: 6px; color: #475569; font-size: 14px; }
        textarea { width: 100%; height: 80px; padding: 10px; border: 1px solid var(--border); border-radius: 6px; font-size: 15px; box-sizing: border-box; font-family: inherit; }
        textarea:focus { outline: 2px solid var(--primary); border-color: transparent; }

        /* æŒ‰é’® */
        .controls { display: flex; gap: 8px; margin: 15px 0 25px 0; flex-wrap: wrap; }
        button { padding: 8px 16px; border: none; border-radius: 6px; cursor: pointer; font-weight: 600; font-size: 14px; transition: 0.1s; color: white; }
        button:hover { opacity: 0.9; transform: translateY(-1px); }
        .btn-convert { background: var(--primary); flex-grow: 2; font-size: 15px; }
        .btn-clear { background: #94a3b8; }
        .btn-zip { background: #f59e0b; }
        .zip-manual { padding: 0 10px; border: 1px solid var(--border); border-radius: 6px; width: 80px; text-align: center; }

        /* ç»“æœåŒº */
        .result-section { margin-bottom: 20px; }
        .result-box { background: #eff6ff; border: 1px solid #93c5fd; color: #1e40af; font-family: "Monaco", "Consolas", monospace; font-size: 15px; line-height: 1.5; font-weight: 500; min-height: 60px; }

        /* è¡¨æ ¼åŒº */
        .split-section { border-top: 2px dashed #e2e8f0; padding-top: 15px; }
        .split-row { display: flex; align-items: center; margin-bottom: 8px; gap: 10px; }
        .field-label { width: 90px; font-weight: 600; color: #64748b; text-align: right; font-size: 13px; flex-shrink: 0; }
        .field-value { flex-grow: 1; padding: 6px 10px; background: #f8fafc; border-radius: 4px; border: 1px solid var(--border); font-family: monospace; color: #334155; font-size: 14px; min-height: 18px; word-break: break-all; }
        .btn-copy-mini { width: 50px; font-size: 11px; padding: 4px 0; background: #10b981; margin: 0; }

        @media (max-width: 600px) {
            .split-row { flex-wrap: wrap; border-bottom: 1px solid #f1f5f9; padding-bottom: 8px; }
            .field-label { text-align: left; width: 100%; }
            .btn-copy-mini { width: 100%; }
        }
    </style>
</head>
<body>

<div class="container">
    <h1>ä¸­æ–‡åœ°å€ -> è‹±æ–‡æ‹¼éŸ³è½¬æ¢å™¨ V5 (ä¿®å¤ç‰ˆ)</h1>
    
    <div style="margin-bottom: 20px;">
        <label>ç²˜è´´å®Œæ•´ä¿¡æ¯ï¼š</label>
        <textarea id="input" placeholder="ä¾‹å¦‚ï¼šåº„ä¸½ä¸½ 13908576456 ç¦å»ºçœæ³‰å·å¸‚ä¸°æ³½åŒºä¸œæµ·è¡—é“æµ·æ˜Ÿè¡—100å·..."></textarea>
    </div>

    <div class="controls">
        <button class="btn-clear" onclick="clearAll()">æ¸…ç©º</button>
        <button class="btn-zip" onclick="searchZip()">ğŸ” æœé‚®ç¼–</button>
        <input type="text" id="manualZip" class="zip-manual" placeholder="å¡«å…¥é‚®ç¼–">
        <button class="btn-convert" onclick="processAll()">å¼€å§‹è½¬æ¢</button>
    </div>

    <div class="result-section">
        <label>å®Œæ•´è½¬æ¢ç»“æœ (Full Line)ï¼š</label>
        <textarea id="fullResult" class="result-box" readonly onclick="this.select()"></textarea>
    </div>

    <div class="split-section">
        <label style="margin-bottom: 10px; display:block; font-size:13px; color:#94a3b8;">æ‹†åˆ†è¯¦æƒ… (Details)ï¼š</label>
        <div id="fieldsContainer"></div>
    </div>
</div>

<script>
    const { pinyin } = pinyinPro;

    // å¤å§“åº“
    const COMPOUND_SURNAMES = [
        "æ¬§é˜³", "å¤ªå²", "ç«¯æœ¨", "ä¸Šå®˜", "å¸é©¬", "ä¸œæ–¹", "ç‹¬å­¤", "å—å®«", "ä¸‡ä¿Ÿ", "é—»äºº", "å¤ä¾¯", "è¯¸è‘›", "å°‰è¿Ÿ", "å…¬ç¾Š", 
        "èµ«è¿", "æ¾¹å°", "çš‡ç”«", "å®—æ”¿", "æ¿®é˜³", "å…¬å†¶", "å¤ªå”", "ç”³å± ", "å…¬å­™", "æ…•å®¹", "ä»²å­™", "é’Ÿç¦»", "é•¿å­™", "å®‡æ–‡", 
        "å¸å¾’", "é²œäº", "å¸ç©º", "é—¾ä¸˜", "å­è½¦", "äº“å®˜", "å¸å¯‡", "å·«é©¬", "å…¬è¥¿", "é¢›å­™", "å£¤é©·", "å…¬è‰¯", "æ¼†é›•", "ä¹æ­£"
    ];

    // 1. å¼ºåŠ›åŠè§’åŒ–å‡½æ•°ï¼šè§£å†³æ‰€æœ‰å…¨è§’å­—ç¬¦é—®é¢˜
    function toHalfWidth(str) {
        let result = "";
        for (let i = 0; i < str.length; i++) {
            let code = str.charCodeAt(i);
            // å…¨è§’ç©ºæ ¼ (12288) -> åŠè§’ç©ºæ ¼ (32)
            if (code === 12288) {
                result += String.fromCharCode(32);
            }
            // å…¨è§’å­—ç¬¦ (65281-65374) -> åŠè§’å­—ç¬¦ (33-126)
            else if (code >= 65281 && code <= 65374) {
                result += String.fromCharCode(code - 65248);
            }
            else {
                result += str.charAt(i);
            }
        }
        return result;
    }

    // 2. æ‹¼éŸ³è½¬æ¢ (CamelCase)
    function toCamel(text) {
        if (!text) return "";
        return text.replace(/[\u4e00-\u9fa5]/g, (char) => {
            const py = pinyin(char, { toneType: 'none', type: 'string' });
            return py.charAt(0).toUpperCase() + py.slice(1);
        });
    }

    function processAll() {
        let original = document.getElementById('input').value;
        let manualZip = document.getElementById('manualZip').value.trim();
        if (!original) return;

        // --- æ­¥éª¤ A: é¢„å¤„ç† ---
        // 1. è½¬åŠè§’
        let raw = toHalfWidth(original);
        // 2. å°†ä¸­æ–‡æ ‡ç‚¹æ›¿æ¢ä¸ºç©ºæ ¼ï¼Œé¿å…ç²˜è¿
        raw = raw.replace(/[ï¼Œã€‚ã€ï¼›ï¼š]/g, ' '); 
        // 3. å»é™¤é¦–å°¾ç©ºç™½
        raw = raw.trim();

        // --- æ­¥éª¤ B: æå–ç”µè¯ (ä¼˜å…ˆæå–å¹¶ç§»é™¤) ---
        let phone = "";
        // åŒ¹é… 11ä½æ‰‹æœºå· æˆ– å›ºå®šç”µè¯
        const phoneRegex = /(1[3-9]\d{9})|(\d{3,4}-?\d{7,8})/;
        const phoneMatch = raw.match(phoneRegex);
        if (phoneMatch) {
            phone = phoneMatch[0];
            // ç§»é™¤ç”µè¯ï¼Œæ›¿æ¢ä¸ºç©ºæ ¼ï¼Œé˜²æ­¢å‰åæ–‡ç²˜è¿
            raw = raw.replace(phone, " ").trim(); 
        }

        // --- æ­¥éª¤ C: æå–é‚®ç¼– ---
        let zip = manualZip;
        if (!zip) {
            const zipRegex = /\d{6}/;
            const zipMatch = raw.match(zipRegex);
            if (zipMatch) {
                zip = zipMatch[0];
                raw = raw.replace(zip, " ").trim();
            }
        }

        // --- æ­¥éª¤ D: æ ¸å¿ƒåˆ†å‰² (å§“å vs åœ°å€) ---
        // ä½¿ç”¨é”šç‚¹æ³•ï¼šæ‰¾åˆ°â€œçœâ€æˆ–â€œå¸‚â€çš„ä½ç½®ï¼Œå·¦è¾¹æ˜¯åå­—ï¼Œå³è¾¹æ˜¯åœ°å€
        let namePart = "";
        let addressPart = "";

        // æŸ¥æ‰¾çœä»½æˆ–ç›´è¾–å¸‚å…³é”®å­—
        // åŒ¹é…ï¼šä»»æ„å­—ç¬¦ + (çœ|è‡ªæ²»åŒº|è¡Œæ”¿åŒº|å¸‚|åœ°åŒº)
        // æ³¨æ„ï¼šè¿™é‡ŒæŸ¥æ‰¾çš„æ˜¯å­—ç¬¦ä¸²ä¸­ç¬¬ä¸€ä¸ªå‡ºç°çš„è¿™äº›è¯
        const splitRegex = /(çœ|è‡ªæ²»åŒº|è¡Œæ”¿åŒº|å¸‚|åœ°åŒº|ç›Ÿ|å·)/;
        const splitMatch = raw.match(splitRegex);

        if (splitMatch) {
            const splitIndex = splitMatch.index;
            
            // å…³é”®å­—åœ¨åœ°å€ä¸­çš„ä½ç½®ã€‚æˆ‘ä»¬éœ€è¦å›æº¯æ‰¾åˆ°åœ°å€çš„èµ·å§‹ç‚¹ã€‚
            // ç®€å•å¤„ç†ï¼šé€šå¸¸å…³é”®å­—çš„å‰2-3ä¸ªå­—æ˜¯çœå/å¸‚åã€‚
            // æ›´ç¨³å¦¥çš„æ–¹æ³•ï¼šå‡è®¾åå­—å’Œåœ°å€ä¹‹é—´æœ‰ç©ºæ ¼ï¼Œæˆ–è€…åå­—åœ¨æœ€å‰é¢ã€‚
            
            // ç­–ç•¥ï¼šå¦‚æœæ‰¾åˆ°äº†å…³é”®å­—ï¼Œæˆ‘ä»¬çœ‹å®ƒå‰é¢æ˜¯å¦æœ‰æ–‡å­—ã€‚
            // è®©æˆ‘ä»¬å°è¯•åœ¨å…³é”®å­—å‰æ‰¾2-3ä¸ªå­—ä½œä¸ºçœåï¼Œå†ä¹‹å‰çš„ä½œä¸ºåå­—ã€‚
            
            // æˆªå–çœä»½å…³é”®å­—ä¹‹å‰çš„å­—ç¬¦ä¸²
            const beforeKeyword = raw.substring(0, splitIndex);
            
            // å€’ç€æ‰¾çœä»½åï¼ˆé€šå¸¸2-3ä¸ªå­—ï¼‰
            // æ¯”å¦‚ "åº„ä¸½ä¸½ ç¦å»º"ï¼Œå…³é”®å­—æ˜¯"çœ"(match indexåœ¨å»ºåé¢ä¸è¡Œï¼Œæ­£åˆ™åŒ¹é…çš„æ˜¯å…³é”®è¯æœ¬èº«)
            // splitMatch[0] æ˜¯ "çœ"ã€‚ splitMatch.index æ˜¯ "çœ" çš„ä½ç½®ã€‚
            
            // æˆ‘ä»¬éœ€è¦ç¡®å®šçœåæœ‰å¤šé•¿ã€‚
            // å¦‚æœæ˜¯ "ç¦å»ºçœ"ï¼ŒsplitIndexæŒ‡å‘"çœ"ã€‚raw[splitIndex-1]æ˜¯"å»º"ï¼Œraw[splitIndex-2]æ˜¯"ç¦"ã€‚
            // ç»å¤§å¤šæ•°çœåæ˜¯2-3ä¸ªå­—ã€‚
            
            // ä¸´æ—¶é€»è¾‘ï¼šæˆ‘ä»¬æŠŠ "çœ" åŠå…¶ä¹‹åçš„æ‰€æœ‰å†…å®¹å½“ä½œåœ°å€ã€‚
            // "çœ" ä¹‹å‰çš„å†…å®¹ï¼Œåˆ‡æ‰æœ€å2-3ä¸ªå­—(çœå)åï¼Œå‰©ä¸‹çš„å°±æ˜¯åå­—ï¼Ÿ
            // ä¸è¡Œï¼Œå¦‚æœç”¨æˆ·è¾“å…¥ "ä¸Šæµ·å¸‚"ï¼Œæ²¡æœ‰"çœ"ã€‚
            
            // V5 æ”¹è¿›ç­–ç•¥ï¼šåˆ©ç”¨ pinyin-pro åº“æ— æ³•åŒºåˆ†è¯­ä¹‰ï¼Œæˆ‘ä»¬ç”¨â€œæ¸…æ´—åçš„å‰©ä½™æ–‡æœ¬â€æ¥åˆ‡åˆ†ã€‚
            // æ—¢ç„¶ç”µè¯å·²ç»æ‹¿èµ°äº†ã€‚
            // å‡è®¾ï¼šåå­—åœ¨æœ€å‰é¢ã€‚åœ°å€ç´§éšå…¶åã€‚
            // æˆ‘ä»¬ç›´æ¥ç”¨æ­£åˆ™æå– "çœ/å¸‚" å®Œæ•´å­—æ®µï¼Œæ‰¾åˆ°å®ƒçš„èµ·å§‹ä½ç½®ã€‚
            
            const provCityRegex = /(.{2,3}?(çœ|è‡ªæ²»åŒº|è¡Œæ”¿åŒº|å¸‚|åœ°åŒº))/; 
            const pcMatch = raw.match(provCityRegex);
            
            if (pcMatch) {
                // pcMatch[0] æ˜¯ä¾‹å¦‚ "ç¦å»ºçœ" æˆ– "ä¸Šæµ·å¸‚"
                const addrStartIndex = raw.indexOf(pcMatch[0]);
                
                // 1. åˆ‡å‰²åå­—
                namePart = raw.substring(0, addrStartIndex).trim();
                
                // 2. åˆ‡å‰²åœ°å€ (ä»çœä»½å¼€å§‹)
                addressPart = raw.substring(addrStartIndex).trim();
            } else {
                // æ²¡æ‰¾åˆ°çœå¸‚å…³é”®å­—ï¼Œå¯èƒ½æ²¡å†™çœï¼Œç›´æ¥å†™è·¯ï¼Ÿ
                // æ­¤æ—¶æŒ‰æ—§é€»è¾‘ï¼šå‰2-3å­—ä¸ºåï¼Œåé¢ä¸ºåœ°å€
                addressPart = raw; // æš‚å­˜
            }
        } else {
            // æ²¡æ‰¾åˆ°å…³é”®å­—ï¼Œå…¨å½“åœ°å€å¤„ç†ï¼Œæˆ–è€…å°è¯•å¼ºè¡Œæå–å¤´éƒ¨ä¸ºåå­—
            // å¦‚æœåœ°å€éƒ¨åˆ†åŒ…å« 'è·¯' 'åŒº' ç­‰ï¼Œå–å‰é¢ä¸ºåå­—
            const possibleAddr = raw.match(/(.+?)(åŒº|å¿|è·¯|è¡—|é•‡)/);
            if (possibleAddr) {
                // è¿™é‡Œæ¯”è¾ƒå±é™©ï¼Œç®€åŒ–å¤„ç†
                addressPart = raw;
            }
        }

        // å§“åå†å¤„ç†ï¼šå¦‚æœåˆ‡å‡ºæ¥çš„ namePart ä¸ºç©ºï¼ˆå¯èƒ½è¿åœ¨ä¸€èµ·äº†ï¼‰ï¼Œä½† addressPart å¾ˆé•¿
        // æ¯”å¦‚ "åº„ä¸½ä¸½ç¦å»ºçœ..."ï¼Œæ­£åˆ™æå– "ç¦å»ºçœ" indexä¸º3ã€‚namePart = raw(0,3) = "åº„ä¸½ä¸½"ã€‚é€»è¾‘æˆç«‹ã€‚
        
        // å§“åæ‹†åˆ† (å§“ + å)
        let surname = "";
        let firstname = "";
        
        // æ¸…ç†ä¸€ä¸‹ namePart (å»æ‰å¯èƒ½æ®‹ç•™çš„ç©ºæ ¼)
        namePart = namePart.replace(/\s+/g, '');
        
        if (namePart.length >= 2) {
            let isCompound = false;
            for (let cs of COMPOUND_SURNAMES) {
                if (namePart.startsWith(cs)) {
                    surname = cs;
                    firstname = namePart.slice(cs.length);
                    isCompound = true;
                    break;
                }
            }
            if (!isCompound) {
                surname = namePart.charAt(0);
                firstname = namePart.slice(1);
            }
        }

        // --- æ­¥éª¤ E: åœ°å€æ·±åº¦è§£æ ---
        // å¯¹ addressPart è¿›è¡Œè§£æ (çœã€å¸‚ã€è¯¦ç»†)
        let province = "";
        let city = "";
        let details = "";
        
        let tempAddr = addressPart;

        // æå–çœ
        const provRegex = /^(.{2,5}?(çœ|è‡ªæ²»åŒº|è¡Œæ”¿åŒº))/;
        const pMatch = tempAddr.match(provRegex);
        if (pMatch) {
            province = pMatch[1];
            tempAddr = tempAddr.replace(province, "").trim();
        }

        // æå–å¸‚
        const cityRegex = /^(.{2,5}?(å¸‚|å·|ç›Ÿ|åœ°åŒº))/;
        const cMatch = tempAddr.match(cityRegex);
        if (cMatch) {
            city = cMatch[1];
            tempAddr = tempAddr.replace(city, "").trim();
        }

        // å‰©ä¸‹çš„å°±æ˜¯è¯¦ç»†åœ°å€ï¼Œè¿›è¡Œåˆ‡è¯
        const longKeywords = ['è¡—é“', 'ç¤¾åŒº', 'æ–°åŒº', 'å¤§å¦', 'ä¸­å¿ƒ', 'å¹¿åœº', 'èŠ±å›­', 'å°åŒº', 'å…¬å¯“', 'å•å…ƒ'];
        const shortKeywords = ['åŒº', 'å¿', 'é•‡', 'æ‘', 'è·¯', 'è¡—', 'å··', 'é“', 'æ®µ', 'å¼„', 'å·', 'æ ‹', 'åº§', 'æ¥¼', 'å®¤', 'æˆ¿', 'å±‚', 'è‹‘'];
        
        let detailParts = [];
        let currentPart = "";
        
        // è¯¦ç»†åœ°å€å»æ‰ç©ºæ ¼
        tempAddr = tempAddr.replace(/\s/g, '');

        for (let i = 0; i < tempAddr.length; i++) {
            const char = tempAddr[i];
            currentPart += char;
            
            if (i < tempAddr.length - 1) {
                const twoChars = char + tempAddr[i+1];
                if (longKeywords.includes(twoChars)) {
                    currentPart += tempAddr[i+1];
                    detailParts.push(currentPart);
                    currentPart = "";
                    i++;
                    continue;
                }
            }
            if (shortKeywords.includes(char)) {
                detailParts.push(currentPart);
                currentPart = "";
            }
        }
        if (currentPart) detailParts.push(currentPart);


        // --- æ­¥éª¤ F: æ‹¼éŸ³è½¬æ¢ä¸ç»„è£… ---
        
        // 1. å§“å (Name) - å¼ºåˆ¶å¤§å†™é¦–å­—æ¯ï¼Œä¸­é—´åŠ ç©ºæ ¼
        const p_surname = toCamel(surname);
        const p_firstname = toCamel(firstname);
        // ç»„åˆï¼šSurname Firstname
        const p_fullName = (p_surname + " " + p_firstname).trim();

        // 2. ç”µè¯ (Phone) - å·²ç»åœ¨å‰é¢æå– phone

        // 3. çœ (Province)
        let p_prov = toCamel(province);
        if (p_prov.endsWith("Sheng")) p_prov = p_prov.slice(0, -5);

        // 4. å¸‚ (City)
        let p_city = toCamel(city);
        if (p_city.endsWith("Shi")) p_city = p_city.slice(0, -3);

        // 5. è¯¦ç»†åœ°å€ (Details) - é€—å·åˆ†éš”
        let p_details = detailParts.map(part => {
             // ä¿ç•™æ•°å­—ï¼Œæ±‰å­—è½¬æ‹¼éŸ³
             return part.replace(/([\u4e00-\u9fa5]+)|([0-9a-zA-Z]+)/g, (m, ch, num) => {
                 if (ch) return toCamel(ch);
                 return m;
             });
        }).filter(p => p).join(", "); 

        // --- æœ€ç»ˆè¾“å‡º (Full Line) ---
        // æ ¼å¼è¦æ±‚ï¼šName Phone Province City Details Zip
        // æ ‡ç‚¹ï¼šå…¨è‹±æ–‡åŠè§’ã€‚éƒ¨åˆ†ä¹‹é—´ç”¨ç©ºæ ¼ï¼ŒDetailå†…éƒ¨ç”¨é€—å·ã€‚
        
        let finalArr = [];
        if (p_fullName) finalArr.push(p_fullName);
        if (phone) finalArr.push(phone);
        if (p_prov) finalArr.push(p_prov);
        if (p_city) finalArr.push(p_city);
        
        // çœ å¸‚ åé¢æ¥è¯¦ç»†åœ°å€
        let header = finalArr.join(" "); 
        let fullLine = header;
        
        if (p_details) fullLine += " " + p_details; // è¯¦ç»†åœ°å€å‰åŠ ç©ºæ ¼
        if (zip) fullLine += " " + zip;

        document.getElementById('fullResult').value = fullLine;

        // æ¸²æŸ“åˆ—è¡¨
        renderFields([
            { label: 'å§“ Surname', val: p_surname },
            { label: 'å Name', val: p_firstname },
            { label: 'ç”µè¯ Phone', val: phone },
            { label: 'çœ Province', val: p_prov },
            { label: 'å¸‚ City', val: p_city },
            { label: 'åœ°å€ Addr', val: p_details },
            { label: 'é‚®ç¼– Zip', val: zip }
        ]);
    }

    function renderFields(data) {
        const container = document.getElementById('fieldsContainer');
        container.innerHTML = "";
        data.forEach(item => {
            const row = document.createElement('div');
            row.className = 'split-row';
            row.innerHTML = `
                <div class="field-label">${item.label}</div>
                <div class="field-value">${item.val || '-'}</div>
                <button class="btn-copy-mini" onclick="copyVal('${item.val || ''}')">å¤åˆ¶</button>
            `;
            container.appendChild(row);
        });
    }

    function copyVal(text) {
        if (!text) return;
        navigator.clipboard.writeText(text);
    }

    function searchZip() {
        const raw = document.getElementById('input').value;
        if(raw) window.open(`https://www.baidu.com/s?wd=${encodeURIComponent(raw + ' é‚®ç¼–')}`, '_blank');
        else alert("è¯·è¾“å…¥å†…å®¹");
    }

    function clearAll() {
        document.getElementById('input').value = "";
        document.getElementById('manualZip').value = "";
        document.getElementById('fullResult').value = "";
        document.getElementById('fieldsContainer').innerHTML = "";
        document.getElementById('input').focus();
    }
</script>

</body>
</html>
