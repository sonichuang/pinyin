<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åœ°å€è½¬æ¢å™¨ V4 (å®Œç¾ä¿®æ­£ç‰ˆ)</title>
    <script src="https://unpkg.com/pinyin-pro"></script>
    <style>
        :root { --primary: #2563eb; --bg: #f1f5f9; --border: #cbd5e1; --text: #334155; }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; background: var(--bg); padding: 20px; color: var(--text); }
        .container { max-width: 900px; margin: 0 auto; background: #fff; padding: 30px; border-radius: 12px; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1); }
        h1 { text-align: center; color: #0f172a; margin-bottom: 20px; font-size: 20px; font-weight: 700; }
        
        /* è¾“å…¥åŒº */
        label { display: block; font-weight: 700; margin-bottom: 6px; color: #475569; font-size: 14px; }
        textarea { width: 100%; height: 80px; padding: 10px; border: 1px solid var(--border); border-radius: 6px; font-size: 15px; box-sizing: border-box; }
        textarea:focus { outline: 2px solid var(--primary); border-color: transparent; }

        /* æŒ‰é’® */
        .controls { display: flex; gap: 8px; margin: 15px 0 25px 0; flex-wrap: wrap; }
        button { padding: 8px 16px; border: none; border-radius: 6px; cursor: pointer; font-weight: 600; font-size: 14px; transition: 0.1s; color: white; }
        button:hover { opacity: 0.9; transform: translateY(-1px); }
        .btn-convert { background: var(--primary); flex-grow: 2; font-size: 15px; }
        .btn-clear { background: #94a3b8; }
        .btn-zip { background: #f59e0b; }
        .zip-manual { padding: 0 10px; border: 1px solid var(--border); border-radius: 6px; width: 80px; text-align: center; }

        /* ç»“æœåŒº */
        .result-section { margin-bottom: 20px; }
        .result-box { background: #eff6ff; border: 1px solid #93c5fd; color: #1e40af; font-family: "Monaco", "Consolas", monospace; font-size: 15px; line-height: 1.5; font-weight: 500; }

        /* è¡¨æ ¼åŒº */
        .split-section { border-top: 2px dashed #e2e8f0; padding-top: 15px; }
        .split-row { display: flex; align-items: center; margin-bottom: 8px; gap: 10px; }
        .field-label { width: 80px; font-weight: 600; color: #64748b; text-align: right; font-size: 13px; flex-shrink: 0; }
        .field-value { flex-grow: 1; padding: 6px 10px; background: #f8fafc; border-radius: 4px; border: 1px solid var(--border); font-family: monospace; color: #334155; font-size: 14px; min-height: 18px; word-break: break-all; }
        .btn-copy-mini { width: 50px; font-size: 11px; padding: 4px 0; background: #10b981; margin: 0; }

        @media (max-width: 600px) {
            .split-row { flex-wrap: wrap; border-bottom: 1px solid #f1f5f9; padding-bottom: 8px; }
            .field-label { text-align: left; width: 100%; }
            .btn-copy-mini { width: 100%; }
        }
    </style>
</head>
<body>

<div class="container">
    <h1>ğŸ‡¨ğŸ‡³ ä¸­æ–‡åœ°å€ -> ğŸ‡ºğŸ‡¸ è‹±æ–‡æ‹¼éŸ³è½¬æ¢å™¨ V4</h1>
    
    <div style="margin-bottom: 20px;">
        <label>ç²˜è´´å®Œæ•´ä¿¡æ¯ï¼š</label>
        <textarea id="input" placeholder="ä¾‹å¦‚ï¼šå¼ ä¸‰ 13800138000 ç¦å»ºçœæ³‰å·å¸‚ä¸°æ³½åŒºä¸œæµ·è¡—é“æµ·æ˜Ÿè¡—..."></textarea>
    </div>

    <div class="controls">
        <button class="btn-clear" onclick="clearAll()">æ¸…ç©º</button>
        <button class="btn-zip" onclick="searchZip()">ğŸ” æœé‚®ç¼–</button>
        <input type="text" id="manualZip" class="zip-manual" placeholder="å¡«å…¥é‚®ç¼–">
        <button class="btn-convert" onclick="processAll()">å¼€å§‹è½¬æ¢</button>
    </div>

    <div class="result-section">
        <label>å®Œæ•´è½¬æ¢ç»“æœ (Full Line)ï¼š</label>
        <textarea id="fullResult" class="result-box" readonly onclick="this.select()"></textarea>
    </div>

    <div class="split-section">
        <label style="margin-bottom: 10px; display:block; font-size:13px; color:#94a3b8;">æ‹†åˆ†è¯¦æƒ… (Details)ï¼š</label>
        
        <div id="fieldsContainer"></div>
    </div>
</div>

<script>
    const { pinyin } = pinyinPro;

    // å¤å§“åº“
    const COMPOUND_SURNAMES = [
        "æ¬§é˜³", "å¤ªå²", "ç«¯æœ¨", "ä¸Šå®˜", "å¸é©¬", "ä¸œæ–¹", "ç‹¬å­¤", "å—å®«", "ä¸‡ä¿Ÿ", "é—»äºº", "å¤ä¾¯", "è¯¸è‘›", "å°‰è¿Ÿ", "å…¬ç¾Š", 
        "èµ«è¿", "æ¾¹å°", "çš‡ç”«", "å®—æ”¿", "æ¿®é˜³", "å…¬å†¶", "å¤ªå”", "ç”³å± ", "å…¬å­™", "æ…•å®¹", "ä»²å­™", "é’Ÿç¦»", "é•¿å­™", "å®‡æ–‡", 
        "å¸å¾’", "é²œäº", "å¸ç©º", "é—¾ä¸˜", "å­è½¦", "äº“å®˜", "å¸å¯‡", "å·«é©¬", "å…¬è¥¿", "é¢›å­™", "å£¤é©·", "å…¬è‰¯", "æ¼†é›•", "ä¹æ­£"
    ];

    // æ‹¼éŸ³é¦–å­—æ¯å¤§å†™
    function toCamel(text) {
        if (!text) return "";
        return text.replace(/[\u4e00-\u9fa5]/g, (char) => {
            const py = pinyin(char, { toneType: 'none', type: 'string' });
            return py.charAt(0).toUpperCase() + py.slice(1);
        });
    }

    // æ ‡ç‚¹æ¸…æ´—ï¼šè½¬åŠè§’ï¼Œå»ç‰¹æ®Šç¬¦å·
    function cleanStr(str) {
        return str
            .replace(/[\uff01-\uff5e]/g, c => String.fromCharCode(c.charCodeAt(0) - 0xfee0)) // å…¨è§’è½¬åŠè§’
            .replace(/[\u3000]/g, ' ') // å…¨è§’ç©ºæ ¼è½¬åŠè§’ç©ºæ ¼
            .replace(/[ï¼Œã€ã€‚ï¼›ï¼š]/g, ' ') // ä¸­æ–‡æ ‡ç‚¹å˜ç©ºæ ¼ï¼Œæ–¹ä¾¿åç»­æ­£åˆ™
            .replace(/\s+/g, ' ') // åˆå¹¶å¤šä½™ç©ºæ ¼
            .trim();
    }

    function processAll() {
        let original = document.getElementById('input').value;
        let manualZip = document.getElementById('manualZip').value.trim();
        if (!original) return;

        // 1. åŸºç¡€æ¸…æ´—
        let raw = cleanStr(original);

        // --- é€æ­¥å‰¥ç¦»æå– (Extract & Remove) ---

        // 2. æå–ç”µè¯ (Phone)
        let phone = "";
        const phoneRegex = /(1[3-9]\d{9})|(\d{3,4}-?\d{7,8})/;
        const phoneMatch = raw.match(phoneRegex);
        if (phoneMatch) {
            phone = phoneMatch[0];
            raw = raw.replace(phone, "").trim(); // å‰”é™¤å¹¶ä¿®å‰ª
        }

        // 3. æå–é‚®ç¼– (Zip)
        let zip = manualZip;
        if (!zip) {
            const zipRegex = /\d{6}/;
            const zipMatch = raw.match(zipRegex);
            if (zipMatch) {
                zip = zipMatch[0];
                raw = raw.replace(zip, "").trim();
            }
        }

        // 4. æå–çœ (Province)
        let provinceRaw = "";
        // åŒ¹é…ï¼šå¼€å¤´æˆ–ç©ºæ ¼åçš„ (xxçœ|è‡ªæ²»åŒº)
        const provRegex = /((.*?)(çœ|è‡ªæ²»åŒº|è¡Œæ”¿åŒº))/; 
        const provMatch = raw.match(provRegex);
        if (provMatch) {
            // æ‰¾åˆ°çœä»½å…³é”®è¯ï¼Œä½†æˆ‘ä»¬è¦ç¡®ä¿å®ƒä¸æ˜¯â€œè¯¦ç»†åœ°å€â€é‡Œçš„æŸä¸ªå­—
            // é€šå¸¸çœä»½ä¼šåœ¨å‰éƒ¨ã€‚è¿™é‡Œæˆ‘ä»¬å‡è®¾åŒ¹é…åˆ°çš„ç¬¬ä¸€ä¸ªå°±æ˜¯çœ
            provinceRaw = provMatch[1]; 
            // å¦‚æœæå–çš„å†…å®¹å¤ªé•¿(è¶…è¿‡6ä¸ªå­—)ï¼Œå¯èƒ½æ˜¯è¯¯åˆ¤ï¼Œè¿™é‡Œç®€å•å¤„ç†
            raw = raw.replace(provinceRaw, "").trim();
            
            // æ¸…ç†ä¸€ä¸‹æå–å‡ºæ¥çš„çœä»½ä¸­å¯èƒ½å¤¹å¸¦çš„ç©ºæ ¼
            provinceRaw = provinceRaw.replace(/\s/g, '');
        }

        // 5. æå–å¸‚ (City)
        let cityRaw = "";
        // æ­¤æ—¶ raw åº”è¯¥ä»¥ å¸‚ å¼€å¤´äº† (å› ä¸ºçœè¢«åˆ äº†)
        // åŒ¹é…ï¼šå¼€å¤´å¤„çš„ (xxå¸‚|åœ°åŒº...)
        const cityRegex = /^(.{2,5}?(å¸‚|å·|ç›Ÿ|åœ°åŒº))/;
        const cityMatch = raw.match(cityRegex);
        if (cityMatch) {
            cityRaw = cityMatch[1];
            raw = raw.replace(cityRaw, "").trim();
        }

        // 6. æå–å§“å (Name)
        // é€»è¾‘ï¼šå‰©ä½™å­—ç¬¦ä¸²çš„å¼€å¤´ï¼Œå¦‚æœæ˜¯2-4ä¸ªæ±‰å­—ï¼Œä¸”ä¸æ˜¯åœ°å€å…³é”®è¯
        let surnameRaw = "";
        let firstNameRaw = "";
        let fullNameRaw = "";

        const addrKeywords = ['åŒº', 'å¿', 'è·¯', 'è¡—', 'å·', 'å®¤', 'é•‡', 'æ‘', 'è‹‘', 'æ ‹', 'æ¥¼'];
        const startPart = raw.split(' ')[0]; // å–ç¬¬ä¸€æ®µï¼ˆé˜²æ­¢å–åˆ°åé¢çš„åœ°å€ï¼‰
        
        let looksLikeAddr = false;
        for (let kw of addrKeywords) {
            if (startPart.includes(kw)) looksLikeAddr = true;
        }

        // å¦‚æœå¼€å¤´ä¸åŒ…å«åœ°å€è¯ï¼Œä¸”é•¿åº¦åˆé€‚ï¼Œè®¤ä¸ºæ˜¯åå­—
        if (!looksLikeAddr && startPart.length >= 2 && startPart.length <= 4) {
            // å¿…é¡»å…¨æ˜¯æ±‰å­—
            if (/^[\u4e00-\u9fa5]+$/.test(startPart)) {
                fullNameRaw = startPart;
                raw = raw.replace(fullNameRaw, "").trim();

                // æ‹†åˆ†å§“/å
                let isCompound = false;
                for (let cs of COMPOUND_SURNAMES) {
                    if (fullNameRaw.startsWith(cs)) {
                        surnameRaw = cs;
                        firstNameRaw = fullNameRaw.slice(cs.length);
                        isCompound = true;
                        break;
                    }
                }
                if (!isCompound) {
                    surnameRaw = fullNameRaw.charAt(0);
                    firstNameRaw = fullNameRaw.slice(1);
                }
            }
        }

        // 7. è¯¦ç»†åœ°å€åˆ‡åˆ†
        // æ­¤æ—¶ raw å‰©ä¸‹çš„å°±æ˜¯è¯¦ç»†åœ°å€ã€‚éœ€è¦ç”¨é€—å·éš”å¼€ã€‚
        // ä¼˜å…ˆåŒå­—å…³é”®è¯ï¼Œåå•å­—
        const longKeywords = ['è¡—é“', 'ç¤¾åŒº', 'æ–°åŒº', 'å¤§å¦', 'ä¸­å¿ƒ', 'å¹¿åœº', 'èŠ±å›­', 'å°åŒº', 'å…¬å¯“'];
        const shortKeywords = ['åŒº', 'å¿', 'é•‡', 'æ‘', 'è·¯', 'è¡—', 'å··', 'é“', 'æ®µ', 'å¼„', 'å·', 'æ ‹', 'åº§', 'æ¥¼', 'å®¤', 'æˆ¿', 'å±‚', 'è‹‘'];

        let parts = [];
        let currentPart = "";
        
        // å»é™¤å‰©ä½™å­—ç¬¦ä¸²ä¸­çš„ç©ºæ ¼ï¼Œé˜²æ­¢å¹²æ‰°
        raw = raw.replace(/\s/g, '');

        for (let i = 0; i < raw.length; i++) {
            const char = raw[i];
            currentPart += char;

            // é¢„åˆ¤åŒå­—
            if (i < raw.length - 1) {
                const twoChars = char + raw[i+1];
                if (longKeywords.includes(twoChars)) {
                    currentPart += raw[i+1]; // æŠŠç¬¬äºŒä¸ªå­—åŠ ä¸Š
                    parts.push(currentPart);
                    currentPart = "";
                    i++; 
                    continue;
                }
            }

            // åˆ¤æ–­å•å­—
            if (shortKeywords.includes(char)) {
                // å¦‚æœæ˜¯æ•°å­—+å· (å¦‚ 900å·)ï¼Œåº”è¯¥åˆ‡åˆ†
                parts.push(currentPart);
                currentPart = "";
            }
        }
        if (currentPart) parts.push(currentPart);


        // --- è½¬æ‹¼éŸ³ & æ ¼å¼åŒ– ---

        // å§“å
        const p_sur = toCamel(surnameRaw);
        const p_first = toCamel(firstNameRaw);
        const p_fullName = (p_sur + " " + p_first).trim();

        // çœå¸‚ (å»åç¼€)
        let p_prov = toCamel(provinceRaw);
        if (p_prov.endsWith("Sheng")) p_prov = p_prov.slice(0, -5);
        
        let p_city = toCamel(cityRaw);
        if (p_city.endsWith("Shi")) p_city = p_city.slice(0, -3);

        // è¯¦ç»†åœ°å€ (å†…éƒ¨ç”¨é€—å·)
        let p_details = parts.map(part => {
             return part.replace(/([\u4e00-\u9fa5]+)|([0-9a-zA-Z]+)/g, (m, ch, num) => {
                 if (ch) return toCamel(ch);
                 return m;
             });
        }).filter(p => p).join(", "); 

        // --- æœ€ç»ˆç»„è£… (Full Line) ---
        // æ ¼å¼ï¼šName Phone Prov City Detail Zip
        // ç¬¦å·ï¼šç©ºæ ¼ ç©ºæ ¼ ç©ºæ ¼ ç©ºæ ¼ é€—å·(åœ¨Detailå†…éƒ¨) ç©ºæ ¼
        
        let finalArr = [];
        if (p_fullName) finalArr.push(p_fullName);
        if (phone) finalArr.push(phone);
        if (p_prov) finalArr.push(p_prov);
        if (p_city) finalArr.push(p_city);
        if (p_details) finalArr.push(p_details);
        if (zip) finalArr.push(zip);

        // ä½¿ç”¨å•ç©ºæ ¼è¿æ¥
        document.getElementById('fullResult').value = finalArr.join(" ");

        // --- æ¸²æŸ“æ‹†åˆ†åˆ—è¡¨ ---
        renderFields([
            { label: 'å§“ Surname', val: p_sur },
            { label: 'å Name', val: p_first },
            { label: 'ç”µè¯ Phone', val: phone },
            { label: 'çœ Province', val: p_prov },
            { label: 'å¸‚ City', val: p_city },
            { label: 'åœ°å€ Addr', val: p_details },
            { label: 'é‚®ç¼– Zip', val: zip }
        ]);
    }

    function renderFields(data) {
        const container = document.getElementById('fieldsContainer');
        container.innerHTML = "";
        data.forEach(item => {
            const row = document.createElement('div');
            row.className = 'split-row';
            row.innerHTML = `
                <div class="field-label">${item.label}</div>
                <div class="field-value" id="val-${item.label}">${item.val || '-'}</div>
                <button class="btn-copy-mini" onclick="copyVal('${item.val || ''}')">å¤åˆ¶</button>
            `;
            container.appendChild(row);
        });
    }

    function copyVal(text) {
        if (!text) return;
        navigator.clipboard.writeText(text);
    }

    function searchZip() {
        const raw = document.getElementById('input').value;
        if(raw) window.open(`https://www.baidu.com/s?wd=${encodeURIComponent(raw + ' é‚®ç¼–')}`, '_blank');
        else alert("è¯·è¾“å…¥å†…å®¹");
    }

    function clearAll() {
        document.getElementById('input').value = "";
        document.getElementById('manualZip').value = "";
        document.getElementById('fullResult').value = "";
        document.getElementById('fieldsContainer').innerHTML = "";
        document.getElementById('input').focus();
    }
</script>

</body>
</html>
