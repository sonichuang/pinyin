<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ™ºèƒ½è‹±æ–‡åœ°å€è½¬æ¢å™¨ (Smart Address Converter)</title>
    <script src="https://unpkg.com/pinyin-pro"></script>
    <style>
        :root { --primary: #2563eb; --bg: #f3f4f6; --white: #ffffff; }
        body { font-family: -apple-system, sans-serif; background: var(--bg); padding: 20px; display: flex; justify-content: center; }
        .container { background: var(--white); width: 100%; max-width: 800px; padding: 30px; border-radius: 12px; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1); }
        h1 { text-align: center; color: #1f2937; margin-bottom: 20px; font-size: 22px; }
        textarea { width: 100%; height: 100px; padding: 12px; border: 1px solid #e5e7eb; border-radius: 8px; font-size: 16px; margin-bottom: 10px; box-sizing: border-box; }
        textarea:focus { outline: 2px solid var(--primary); border-color: transparent; }
        
        .output-box { background: #f8fafc; color: #2563eb; font-family: monospace; font-size: 16px; line-height: 1.6; }
        
        .controls { display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap; }
        .zip-group { display: flex; align-items: center; gap: 5px; flex-grow: 1; }
        .zip-input { padding: 10px; border: 1px solid #e5e7eb; border-radius: 6px; width: 100px; }
        
        button { padding: 10px 20px; border: none; border-radius: 6px; cursor: pointer; color: white; font-weight: 500; transition: 0.2s; }
        .btn-convert { background: var(--primary); flex-grow: 2; }
        .btn-search-zip { background: #f59e0b; }
        .btn-copy { background: #10b981; width: 100%; margin-top: 10px; }
        .btn-clear { background: #9ca3af; }
        button:hover { opacity: 0.9; }

        .note { font-size: 12px; color: #6b7280; margin-top: 5px; }
    </style>
</head>
<body>

<div class="container">
    <h1>æ™ºèƒ½åœ°å€åˆ†è¯è½¬æ‹¼éŸ³</h1>
    
    <label>è¾“å…¥ä¸­æ–‡åœ°å€ï¼š</label>
    <textarea id="input" placeholder="ä¾‹å¦‚ï¼šç¦å»ºçœæ³‰å·å¸‚æ´›æ±ŸåŒºä¸‡è£è¡—97å·æ´›æ±Ÿäººæ°‘æ”¿åºœå¤§æ¥¼å‰æ¥¼1213"></textarea>

    <div class="controls">
        <button class="btn-clear" onclick="clearAll()">æ¸…ç©º</button>
        <button class="btn-search-zip" onclick="searchZip()">ğŸ” æœé‚®ç¼–</button>
        <div class="zip-group">
            <input type="text" id="zipInput" class="zip-input" placeholder="å¡«å…¥é‚®ç¼–">
        </div>
        <button class="btn-convert" onclick="processAddress()">è½¬æ¢ (Convert)</button>
    </div>

    <label>è½¬æ¢ç»“æœï¼š</label>
    <textarea id="output" class="output-box" readonly></textarea>
    <button class="btn-copy" onclick="copyResult()">å¤åˆ¶ç»“æœ</button>
    <div class="note">* è‡ªåŠ¨ç§»é™¤äº†Sheng/Shiåç¼€ï¼Œçœå¸‚ç©ºæ ¼åˆ†éš”ï¼Œå…¶ä»–é€—å·åˆ†éš”ã€‚</div>
</div>

<script>
    const { pinyin } = pinyinPro;

    function toPinyinCamel(text) {
        if (!text) return "";
        // æ›¿æ¢æ¯ä¸ªæ±‰å­—ä¸ºæ‹¼éŸ³
        return text.replace(/[\u4e00-\u9fa5]/g, (char) => {
            const py = pinyin(char, { toneType: 'none', type: 'string' });
            return py.charAt(0).toUpperCase() + py.slice(1);
        });
    }

    function processAddress() {
        let raw = document.getElementById('input').value.trim();
        const zip = document.getElementById('zipInput').value.trim();
        
        if (!raw) return;

        // 1. æå–çœä»½ (åŒ¹é… 'çœ' æˆ– è‡ªæ²»åŒº)
        let province = "";
        const provRegex = /(.+?(çœ|è‡ªæ²»åŒº|è¡Œæ”¿åŒº))/;
        const provMatch = raw.match(provRegex);
        if (provMatch) {
            province = provMatch[1];
            raw = raw.replace(province, ""); // ä»åŸå¥ä¸­ç§»é™¤
        }

        // 2. æå–åŸå¸‚ (åŒ¹é… 'å¸‚' æˆ– å·/ç›Ÿï¼Œä½†åœ¨çœä¹‹å)
        let city = "";
        const cityRegex = /(.+?(å¸‚|å·|ç›Ÿ|åœ°åŒº))/;
        const cityMatch = raw.match(cityRegex);
        if (cityMatch) {
            city = cityMatch[1];
            raw = raw.replace(city, "");
        }

        // 3. æ™ºèƒ½åˆ†è¯å…¶ä»–éƒ¨åˆ† (åŒº, å¿, è·¯, è¡—, å·, æ ‹, æ¥¼, å®¤)
        // é€»è¾‘ï¼šåˆ©ç”¨æ­£åˆ™åˆ‡å‰²ï¼Œä¿ç•™åˆ†éš”ç¬¦
        // åŒ¹é…é€»è¾‘ï¼šä»»æ„æ–‡å­— + (åŒº|å¿|è·¯|è¡—|å··|é“|å·|æ ‹|åº§|æ¥¼|å®¤|æˆ¿|è‹‘|å¤§å¦|ä¸­å¿ƒ)
        const parts = [];
        
        // å®šä¹‰åˆ†å‰²å…³é”®å­—
        const keywords = ['åŒº', 'å¿', 'å¸‚', 'è·¯', 'è¡—', 'å··', 'é“', 'æ®µ', 'å·', 'æ ‹', 'åº§', 'æ¥¼', 'å®¤', 'æˆ¿', 'è‹‘', 'å¤§å¦', 'ä¸­å¿ƒ', 'å¹¿åœº'];
        
        let currentPart = "";
        for (let i = 0; i < raw.length; i++) {
            currentPart += raw[i];
            // å¦‚æœå½“å‰å­—æ˜¯å…³é”®å­—ï¼Œæˆ–è€…é‡åˆ°æ•°å­—ç»“æŸï¼ˆä¾‹å¦‚ 1213 è¿™ç§æ²¡å•ä½çš„ï¼‰
            // ç®€å•å¤„ç†ï¼šå¦‚æœå½“å‰å­—ç¬¦åœ¨å…³é”®å­—é‡Œï¼Œåˆ‡åˆ†
            if (keywords.includes(raw[i])) {
                parts.push(currentPart);
                currentPart = "";
            }
        }
        if (currentPart) parts.push(currentPart); // æŠŠå‰©ä¸‹çš„ï¼ˆå¦‚ 1213ï¼‰åŠ ä¸Š

        // --- å¼€å§‹è½¬æ¢ ---

        // å¤„ç†çœï¼šè½¬æ‹¼éŸ³ -> å»æ‰ "Sheng"
        let p_prov = toPinyinCamel(province);
        if (p_prov.endsWith("Sheng")) p_prov = p_prov.slice(0, -5);

        // å¤„ç†å¸‚ï¼šè½¬æ‹¼éŸ³ -> å»æ‰ "Shi"
        let p_city = toPinyinCamel(city);
        if (p_city.endsWith("Shi")) p_city = p_city.slice(0, -3);

        // å¤„ç†å‰©ä½™éƒ¨åˆ†
        let p_others = parts.map(part => {
            // ä¿ç•™åŸæœ‰æ•°å­—å’Œéä¸­æ–‡å­—ç¬¦
            return part.replace(/([\u4e00-\u9fa5]+)|([0-9a-zA-Z]+)/g, (match, ch, num) => {
                if (ch) return toPinyinCamel(ch);
                return match; // æ•°å­—ç›´æ¥è¿”å›
            });
        }).filter(p => p.trim() !== ""); // è¿‡æ»¤ç©º

        // --- ç»„è£…æœ€ç»ˆç»“æœ ---
        // è§„åˆ™ï¼šçœ å¸‚ (ç©ºæ ¼) å…¶ä»– (é€—å·)
        let finalArr = [];
        if (p_prov) finalArr.push(p_prov);
        if (p_city) finalArr.push(p_city);
        
        // å‰ä¸¤ä¸ªå…ƒç´ ç”¨ç©ºæ ¼è¿æ¥
        let header = finalArr.join(" "); 
        
        // åé¢çš„ç”¨é€—å·è¿æ¥
        let body = p_others.join(", ");

        // æ‹¼æ¥å¤´éƒ¨å’Œä¸»ä½“
        let result = header;
        if (body) {
            result += (result ? " " : "") + body;
        }

        // åŠ ä¸Šé‚®ç¼– (å¦‚æœæœ‰)
        if (zip) {
            result += " " + zip;
        }

        document.getElementById('output').value = result;
    }

    function searchZip() {
        const address = document.getElementById('input').value;
        if (address) {
            // æ‰“å¼€ç™¾åº¦æœç´¢é‚®ç¼–
            window.open(`https://www.baidu.com/s?wd=${encodeURIComponent(address + ' é‚®ç¼–')}`, '_blank');
        } else {
            alert("è¯·å…ˆè¾“å…¥åœ°å€");
        }
    }

    function copyResult() {
        const el = document.getElementById('output');
        el.select();
        document.execCommand('copy');
    }

    function clearAll() {
        document.getElementById('input').value = "";
        document.getElementById('output').value = "";
        document.getElementById('zipInput').value = "";
        document.getElementById('input').focus();
    }
</script>

</body>
</html>
